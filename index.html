<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>测试 Dify Workflow</title>
</head>
<body>
  <h2>请输入内容：</h2>
  <input type="text" id="userInput" />
  <button onclick="callDify()">提交</button>

  <h3>AI 回答：</h3>
  <div id="responseBox" style="white-space: pre-wrap;"></div>

  <script>
    async function callDify() {
      const inputText = document.getElementById('userInput').value;
      const responseBox = document.getElementById('responseBox');
      responseBox.innerText = "正在请求，请稍等...";

      const apiKey = "你的API Key"; // 替换
      const endpoint = "https://api.dify.ai/v1/workflows/chat/你的WorkflowID/run"; // 替换

      try {
        const res = await fetch(endpoint, {
          method: "POST",
          headers: {
            "Authorization": `Bearer ${apiKey}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            inputs: {
              "sys.query": inputText
            },
            response_mode: "blocking"
          })
        });

        if (!res.ok) throw new Error("HTTP错误：" + res.status);
        const data = await res.json();

        if (data.outputs && data.outputs.reply) {
          responseBox.innerText = data.outputs.reply;
        } else {
          responseBox.innerText = "⚠️ 没有收到 AI 回答：" + JSON.stringify(data);
        }
      } catch (err) {
        responseBox.innerText = "❌ 请求失败：" + err.message;
      }
    }
  </script>
</body>
</html>
