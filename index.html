<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>Dify Workflow 调用测试</title>
</head>
<body>
  <h2>请输入内容：</h2>
  <input type="text" id="userInput" style="width: 300px;" />
  <button onclick="callDify()">提交</button>

  <h3>AI 回答：</h3>
  <div id="responseBox" style="white-space: pre-wrap; border: 1px solid #ccc; padding: 10px; width: 80%;"></div>

  <script>
    async function callDify() {
      const inputText = document.getElementById('userInput').value;
      const apiKey = "app-9xerNfbVnPtYtG4jajZF3ZHL";
      const endpoint = "https://api.dify.ai/v1/workflows/wl_BKtK6kYgG5nw6I0N/run";

      const responseBox = document.getElementById('responseBox');
      responseBox.innerText = "请求中...";

      try {
        const res = await fetch(endpoint, {
          method: "POST",
          headers: {
            "Authorization": `Bearer ${apiKey}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            inputs: {
              user_input: inputText
            },
            response_mode: "blocking"
          })
        });

        const data = await res.json();
        console.log("返回数据：", data);

        if (data.outputs && data.outputs.reply) {
          responseBox.innerText = data.outputs.reply;
        } else {
          responseBox.innerText = "⚠️ 未获取到回复内容。\n完整返回内容：\n" + JSON.stringify(data, null, 2);
        }
      } catch (error) {
        responseBox.innerText = "❌ 请求失败：" + error.message;
      }
    }
  </script>
</body>
</html>
